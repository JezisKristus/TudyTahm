<div class="d-flex">
  <!-- Sidebar on the left -->
  <app-sidebar class="d-flex flex-column flex-shrink-0"></app-sidebar>

  <!-- Map and journey info on the right -->
  <div class="flex-grow-1 d-flex flex-row-reverse" style="height: 100vh;">
    <!-- Points/info panel on the right -->
    <div class="journey-info-panel">
      <div class="header">
        <div class="journey-icon">
          <i class="fas fa-route"></i>
        </div>
        <input 
          class="journey-name" 
          placeholder="Journey name..." 
          [(ngModel)]="journeyName"
          [readonly]="!canEdit" />
      </div>

      <div *ngIf="loading" class="loading-indicator">
        <i class="fas fa-spinner fa-spin"></i> Loading journey...
      </div>
      <div *ngIf="error" class="error-message">
        {{ error }}
      </div>
      <div *ngIf="successMessage" class="success-message">
        <i class="fas fa-check-circle"></i> {{ successMessage }}
      </div>

      <div class="journey-description" *ngIf="!loading && !error">
        <textarea
          class="description-input"
          placeholder="Add a description for your journey..."
          [(ngModel)]="journeyDescription"
          [readonly]="!canEdit"
          rows="4"
          maxlength="500">
        </textarea>
        <div class="char-counter">{{journeyDescription.length}}/500 characters</div>
      </div>

      <div class="distance" *ngIf="!loading && !error">
        Journey distance: {{ distance }} km
      </div>

      <div class="buttons" *ngIf="!loading && !error">
        <button class="share" title="Share this journey with others" *ngIf="canEdit">
          <i class="fas fa-share-alt"></i> Share
        </button>
        <button class="save" title="Save your changes" (click)="saveJourney()" *ngIf="canEdit">
          <i class="fas fa-save"></i> Save
        </button>
        <button class="discard" title="Discard changes and return to journey list" (click)="discardChanges()">
          <i class="fas fa-times"></i> Discard
        </button>
      </div>
    </div>

    <!-- Map on the left of the info panel (but right of sidebar) -->
    <div class="map flex-grow-1">
      <div leaflet [leafletOptions]="mapOptions" [leafletLayers]="mapLayers" (leafletMapReady)="onMapReady($event)" style="height: 100%; width: 100%"></div>
    </div>
  </div>
</div>

<!-- Remove point dialog -->
<div *ngIf="showRemoveDialog" class="remove-dialog-overlay" (click)="closeRemoveDialog()">
  <div class="remove-dialog-popup" [ngStyle]="dialogPosition ? {'left.px': dialogPosition.x, 'top.px': dialogPosition.y} : {}" (click)="$event.stopPropagation()">
    <ng-container *ngIf="!removeConfirmed; else removed">
      <div class="dialog-title">
        <i class="fas fa-exclamation-triangle"></i>
        Remove point?
      </div>
      <div class="dialog-body">
        <p>Do you really want to remove this point from your journey?</p>
        <div class="coords">
          <i class="fas fa-map-marker-alt"></i>
          {{pointToRemove?.lat | number:'1.6-6'}}, {{pointToRemove?.lng | number:'1.6-6'}}
        </div>
      </div>
      <div class="dialog-actions">
        <button class="cancel" (click)="closeRemoveDialog()">
          <i class="fas fa-times"></i> Cancel
        </button>
        <button class="confirm" (click)="confirmRemovePoint()">
          <i class="fas fa-trash-alt"></i> Remove
        </button>
      </div>
    </ng-container>
    <ng-template #removed>
      <div class="dialog-title success">
        <i class="fas fa-check-circle"></i>
        Point removed
      </div>
    </ng-template>
  </div>
</div>
